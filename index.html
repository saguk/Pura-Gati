<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPS Skater: Jelajah Nusantara</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
            background-color: #0f172a;
            user-select: none; /* Mencegah seleksi teks saat main di HP */
        }
        
        /* Font Khusus Judul Game */
        .font-game {
            font-family: 'Bangers', system-ui;
            letter-spacing: 2px;
        }

        .neon-box {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(147, 51, 234, 0.5);
            box-shadow: 0 0 30px rgba(147, 51, 234, 0.4);
        }

        #gameCanvas {
            background: linear-gradient(180deg, #87CEEB 0%, #E0F7FA 60%, #4ade80 60%, #22c55e 100%);
            width: 100%;
            height: 100%;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
        }

        /* Animasi Tombol */
        .btn-press:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="text-white h-screen w-screen relative">

    <!-- ==================== HALAMAN LOGIN & MENU ==================== -->
    <div id="login-screen" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-[url('https://images.unsplash.com/photo-1541701494587-cb58502866ab?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center">
        <div class="absolute inset-0 bg-slate-900/80"></div>
        
        <div class="neon-box p-8 rounded-2xl w-full max-w-md relative z-10 text-center transform transition-all duration-300">
            <div class="flex justify-center mb-4">
                <i data-lucide="zap" class="w-16 h-16 text-yellow-400 fill-current animate-pulse"></i>
            </div>
            <h1 class="text-5xl font-game text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 mb-2">IPS SKATER</h1>
            <p class="text-slate-300 mb-6">Siap menjelajahi pengetahuan sosial?</p>

            <!-- Form Login -->
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div class="relative">
                    <i data-lucide="user" class="absolute left-3 top-3.5 text-slate-400 w-5 h-5"></i>
                    <input type="text" id="username" required placeholder="Masukkan Nama Kamu" 
                        class="w-full bg-slate-800/50 border border-slate-600 rounded-lg py-3 pl-10 pr-4 focus:outline-none focus:border-purple-500 text-white placeholder-slate-500 transition-colors">
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <button type="button" onclick="showInstructions()" class="btn-press bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2 border border-slate-500">
                        <i data-lucide="info" class="w-5 h-5"></i> Cara Main
                    </button>
                    <button type="submit" class="btn-press bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold py-3 rounded-lg shadow-lg flex items-center justify-center gap-2">
                        MULAI <i data-lucide="play" class="w-5 h-5"></i>
                    </button>
                </div>
            </form>
        </div>
        <div class="absolute bottom-4 text-slate-500 text-sm">Created for Social Studies Learning</div>
    </div>

    <!-- ==================== MODAL INSTRUKSI ==================== -->
    <div id="instructions-modal" class="absolute inset-0 z-[60] hidden modal-overlay flex items-center justify-center p-4">
        <div class="bg-white text-slate-800 rounded-2xl w-full max-w-lg shadow-2xl p-6 relative animate-fade-in-up">
            <button onclick="hideInstructions()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                <i data-lucide="x-circle" class="w-8 h-8"></i>
            </button>
            
            <h2 class="text-2xl font-bold text-purple-600 mb-4 flex items-center gap-2">
                <i data-lucide="gamepad-2"></i> Cara Bermain
            </h2>
            
            <div class="space-y-4 text-slate-600">
                <div class="flex items-start gap-3">
                    <div class="bg-purple-100 p-2 rounded-lg text-purple-600">
                        <i data-lucide="arrow-up-circle" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="font-bold text-slate-800">Kontrol</p>
                        <p class="text-sm">Tekan <span class="font-mono bg-slate-200 px-1 rounded">SPASI</span> atau <span class="font-mono bg-slate-200 px-1 rounded">SENTUH LAYAR</span> untuk melompat.</p>
                    </div>
                </div>

                <div class="flex items-start gap-3">
                    <div class="bg-red-100 p-2 rounded-lg text-red-600">
                        <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="font-bold text-slate-800">Hindari Rintangan</p>
                        <p class="text-sm">Jangan menabrak Batu atau Tong Sampah, nyawamu akan berkurang!</p>
                    </div>
                </div>

                <div class="flex items-start gap-3">
                    <div class="bg-yellow-100 p-2 rounded-lg text-yellow-600">
                        <i data-lucide="scroll" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="font-bold text-slate-800">Ambil Gulungan Ilmu</p>
                        <p class="text-sm">Tabrak gulungan kertas untuk menjawab Kuis IPS. Jawab benar untuk dapat skor besar!</p>
                    </div>
                </div>
            </div>

            <button onclick="hideInstructions()" class="mt-6 w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl shadow-md transition-colors">
                Saya Mengerti!
            </button>
        </div>
    </div>

    <!-- ==================== UI GAME (HUD) ==================== -->
    <div id="game-ui" class="absolute inset-0 pointer-events-none hidden z-10">
        <!-- Top Bar -->
        <div class="flex justify-between items-start p-4">
            <div class="flex flex-col gap-2">
                <div class="bg-black/50 backdrop-blur-md px-4 py-2 rounded-full flex items-center gap-2 border border-white/20 shadow-lg">
                    <i data-lucide="user-circle" class="text-yellow-400 w-6 h-6"></i>
                    <span id="player-name-display" class="font-bold text-lg">Player</span>
                </div>
                <div class="bg-black/50 backdrop-blur-md px-4 py-2 rounded-full flex items-center gap-2 border border-white/20 shadow-lg">
                    <i data-lucide="heart" class="text-red-500 fill-current w-5 h-5"></i>
                    <span id="lives-display" class="font-bold text-lg">3</span>
                </div>
            </div>

            <div class="bg-black/50 backdrop-blur-md px-6 py-2 rounded-full border border-white/20 text-center shadow-lg">
                <div class="text-xs text-slate-300 uppercase tracking-wider">Skor</div>
                <div id="score-display" class="text-3xl font-game text-yellow-400">0</div>
            </div>
        </div>
    </div>

    <!-- ==================== GAME CANVAS ==================== -->
    <canvas id="gameCanvas" class="block"></canvas>

    <!-- ==================== MODAL KUIS IPS ==================== -->
    <div id="quiz-modal" class="absolute inset-0 z-40 hidden modal-overlay flex items-center justify-center p-4">
        <div class="bg-white text-slate-800 rounded-2xl w-full max-w-lg shadow-2xl overflow-hidden animate-fade-in-up border-4 border-purple-500">
            <div class="bg-purple-600 p-4 flex justify-between items-center">
                <h3 class="text-white font-bold text-xl flex items-center gap-2">
                    <i data-lucide="help-circle" class="w-6 h-6"></i> TANTANGAN IPS
                </h3>
                <div class="bg-white/20 px-3 py-1 rounded-full text-white font-bold text-sm">Poin x500</div>
            </div>
            
            <div class="p-6">
                <p id="question-text" class="text-xl font-bold mb-6 text-center text-slate-700">Soal akan muncul di sini...</p>
                
                <div id="options-container" class="grid grid-cols-1 gap-3">
                    <!-- Options injected by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== GAME OVER MODAL ==================== -->
    <div id="game-over-modal" class="absolute inset-0 z-50 hidden bg-black/90 flex items-center justify-center p-4">
        <div class="text-center p-8 border-2 border-red-500 rounded-2xl bg-slate-900">
            <h2 class="text-6xl font-game text-red-500 mb-4 animate-bounce">GAME OVER</h2>
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 mb-8 max-w-sm mx-auto">
                <p class="text-slate-400 mb-2">Skor Akhir Kamu</p>
                <p id="final-score" class="text-5xl font-bold text-white">0</p>
            </div>
            <button onclick="restartGame()" class="bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 px-8 rounded-full text-xl transition-transform hover:scale-105 flex items-center gap-2 mx-auto shadow-[0_0_20px_rgba(234,179,8,0.5)]">
                <i data-lucide="rotate-ccw"></i> MAIN LAGI
            </button>
        </div>
    </div>

    <script>
        // Init Icons
        lucide.createIcons();

        // --- AUDIO ENGINE (Simple Synth) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            const now = audioCtx.currentTime;

            if (type === 'jump') {
                // Suara "Hop" naik
                osc.type = 'sine';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.linearRampToValueAtTime(500, now + 0.1);
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } 
            else if (type === 'collect') {
                // Suara "Ding" tinggi
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.setValueAtTime(1200, now + 0.1);
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.linearRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            }
            else if (type === 'hit') {
                // Suara "Buzz" rendah
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            }
            else if (type === 'correct') {
                // Suara "Tadaa" (Major Chord Arpeggio)
                playNote(523.25, now, 0.1); // C
                playNote(659.25, now + 0.1, 0.1); // E
                playNote(783.99, now + 0.2, 0.2); // G
            }
        }

        function playNote(freq, time, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.2, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + duration);
            osc.start(time);
            osc.stop(time + duration);
        }

        // --- DATA SOAL IPS ---
        const questions = [
            { q: "Apa ibukota provinsi Jawa Barat?", options: ["Surabaya", "Semarang", "Bandung", "Medan"], correct: 2 },
            { q: "Siapakah proklamator kemerdekaan Indonesia?", options: ["Soeharto", "Soekarno - Hatta", "B.J. Habibie", "Ki Hajar Dewantara"], correct: 1 },
            { q: "Kegiatan menghasilkan barang atau jasa disebut...", options: ["Produksi", "Konsumsi", "Distribusi", "Retribusi"], correct: 0 },
            { q: "Peta kecil yang menjelaskan bagian tertentu pada peta utama disebut...", options: ["Legenda", "Inset", "Skala", "Judul"], correct: 1 },
            { q: "Organisasi negara-negara Asia Tenggara disebut...", options: ["PBB", "NATO", "ASEAN", "WHO"], correct: 2 },
            { q: "Indonesia terletak di antara dua benua, yaitu...", options: ["Asia & Afrika", "Asia & Australia", "Eropa & Asia", "Australia & Amerika"], correct: 1 },
            { q: "Candi Borobudur adalah peninggalan agama...", options: ["Hindu", "Islam", "Buddha", "Kristen"], correct: 2 }
        ];

        // --- VARIABEL GAME ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = 'LOGIN';
        let score = 0;
        let lives = 3;
        let gameSpeed = 5;
        let frameCount = 0;
        let animationId;
        
        const gravity = 0.6;
        
        const player = {
            x: 50,
            y: 0,
            width: 40,
            height: 70, // Lebih tinggi karena ada orangnya
            dy: 0,
            jumpStrength: -13,
            grounded: false
        };

        let obstacles = [];
        let items = [];
        let particles = [];

        // --- INSTRUKSI & LOGIN ---
        function showInstructions() {
            document.getElementById('instructions-modal').classList.remove('hidden');
        }
        function hideInstructions() {
            document.getElementById('instructions-modal').classList.add('hidden');
        }

        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            if(username) {
                document.getElementById('player-name-display').innerText = username;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('game-ui').classList.remove('hidden');
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);
                // Resume audio context just in case
                if (audioCtx.state === 'suspended') audioCtx.resume();
                startGame();
            }
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.groundY = canvas.height - 100; 
        }

        // --- GAME LOOP ---
        function startGame() {
            gameState = 'PLAYING';
            score = 0;
            lives = 3;
            gameSpeed = 6;
            obstacles = [];
            items = [];
            player.y = player.groundY;
            
            updateHUD();
            animate();
        }

        function animate() {
            if (gameState !== 'PLAYING') return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            updatePlayer();
            drawCharacter(); // FUNGSI BARU UNTUK MENGGAMBAR ORANG
            handleEntities();

            // Ground
            ctx.fillStyle = '#22c55e';
            ctx.fillRect(0, player.groundY + 40, canvas.width, canvas.height);
            ctx.fillStyle = '#166534'; // Rumput detail
            ctx.fillRect(0, player.groundY + 40, canvas.width, 10);
            
            // Score
            frameCount++;
            if (frameCount % 10 === 0) score++;
            updateHUD();

            animationId = requestAnimationFrame(animate);
        }

        // --- VISUAL KARAKTER ---
        function drawCharacter() {
            const x = player.x;
            const y = player.y;

            // 1. Skateboard
            // Roda
            ctx.fillStyle = '#1e293b'; 
            ctx.beginPath(); ctx.arc(x + 10, y + 65, 6, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(x + 40, y + 65, 6, 0, Math.PI*2); ctx.fill();
            // Papan
            ctx.fillStyle = '#fbbf24'; // Kuning
            ctx.beginPath();
            ctx.roundRect(x, y + 55, 50, 12, 5);
            ctx.fill();
            // Grip tape (hitam atas papan)
            ctx.fillStyle = '#000'; 
            ctx.fillRect(x + 5, y + 55, 40, 3);

            // 2. Kaki
            ctx.fillStyle = '#1e40af'; // Celana Biru
            // Kaki kiri (belakang)
            ctx.fillRect(x + 10, y + 40, 10, 20); 
            // Kaki kanan (depan)
            ctx.fillRect(x + 30, y + 40, 10, 20);

            // 3. Badan (Baju)
            ctx.fillStyle = '#ef4444'; // Baju Merah
            ctx.fillRect(x + 10, y + 15, 30, 30);
            
            // Logo di baju (putih)
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(x + 25, y + 30, 5, 0, Math.PI*2); ctx.fill();

            // 4. Kepala
            ctx.fillStyle = '#fca5a5'; // Kulit
            ctx.beginPath(); ctx.arc(x + 25, y + 10, 12, 0, Math.PI*2); ctx.fill();

            // 5. Rambut / Topi
            ctx.fillStyle = '#000'; // Topi Hitam (terbalik)
            ctx.beginPath(); ctx.arc(x + 25, y + 8, 13, Math.PI, 0); ctx.fill();
            ctx.fillRect(x + 10, y + 8, 30, 5); // Visor topi

            // Rotasi jika melompat
            if (!player.grounded) {
                // (Ini hanya efek visual sederhana, implementasi rotasi penuh lebih kompleks)
            }
        }

        // --- LOGIKA PLAYER ---
        function updatePlayer() {
            if (!player.grounded) {
                player.dy += gravity;
            } else {
                player.dy = 0;
            }
            player.y += player.dy;

            if (player.y > player.groundY - 20) { // -20 offset visual agar pas di papan
                player.y = player.groundY - 20;
                player.grounded = true;
                player.dy = 0;
            } else {
                player.grounded = false;
            }
        }

        function jump() {
            if (player.grounded && gameState === 'PLAYING') {
                player.dy = player.jumpStrength;
                player.grounded = false;
                playSound('jump');
            }
        }

        // --- INPUT HANDLER ---
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') jump();
        });
        window.addEventListener('touchstart', (e) => {
            jump();
        });
        window.addEventListener('click', (e) => {
            if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'INPUT') jump();
        });

        // --- ENTITAS ---
        function handleEntities() {
            // Spawn Obstacle
            if (frameCount % 120 === 0 && Math.random() > 0.3) {
                obstacles.push({
                    x: canvas.width,
                    y: player.groundY + 15,
                    width: 40,
                    height: 40,
                    type: Math.random() > 0.5 ? 'ðŸª¨' : 'ðŸš§'
                });
            }

            // Spawn Item (Gulungan)
            if (frameCount % 450 === 0) {
                items.push({
                    x: canvas.width,
                    y: player.groundY - 60,
                    width: 40,
                    height: 40,
                    type: 'ðŸ“œ'
                });
            }

            // Loop Obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                let obs = obstacles[i];
                obs.x -= gameSpeed;
                ctx.font = "40px Arial";
                ctx.fillText(obs.type, obs.x, obs.y + 35);

                if (checkCollision(obs)) {
                    playSound('hit');
                    hitObstacle();
                    obstacles.splice(i, 1);
                }
                if (obs.x + obs.width < 0) obstacles.splice(i, 1);
            }

            // Loop Items
            for (let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                item.x -= gameSpeed;
                let floatY = Math.sin(frameCount * 0.1) * 10;
                
                ctx.font = "40px Arial";
                // Efek glow pada item
                ctx.shadowColor = "yellow";
                ctx.shadowBlur = 10;
                ctx.fillText(item.type, item.x, item.y + 35 + floatY);
                ctx.shadowBlur = 0;

                if (checkCollision(item)) {
                    playSound('collect');
                    triggerQuiz();
                    items.splice(i, 1);
                }
                if (item.x + item.width < 0) items.splice(i, 1);
            }
        }

        function checkCollision(obj) {
            // Kotak collision player sedikit lebih kecil dari visual agar adil
            return (
                player.x < obj.x + obj.width - 10 &&
                player.x + 40 > obj.x + 10 &&
                player.y < obj.y + obj.height &&
                player.y + player.height > obj.y
            );
        }

        function hitObstacle() {
            lives--;
            updateHUD();
            const ui = document.getElementById('game-ui');
            ui.classList.add('bg-red-500/30');
            setTimeout(() => ui.classList.remove('bg-red-500/30'), 200);
            if (lives <= 0) {
                playSound('hit'); 
                gameOver();
            }
        }

        // --- SISTEM KUIS ---
        function triggerQuiz() {
            gameState = 'QUIZ';
            cancelAnimationFrame(animationId);
            
            const modal = document.getElementById('quiz-modal');
            const qText = document.getElementById('question-text');
            const optsContainer = document.getElementById('options-container');
            
            const q = questions[Math.floor(Math.random() * questions.length)];
            
            qText.innerText = q.q;
            optsContainer.innerHTML = '';
            
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded-xl border-2 border-slate-100 hover:bg-purple-50 hover:border-purple-500 transition-all font-bold text-slate-600 active:scale-95";
                btn.innerText = opt;
                btn.onclick = () => checkQuizAnswer(index, q.correct);
                optsContainer.appendChild(btn);
            });

            modal.classList.remove('hidden');
        }

        function checkQuizAnswer(selected, correct) {
            const modal = document.getElementById('quiz-modal');
            
            if (selected === correct) {
                playSound('correct');
                score += 500;
                gameSpeed += 0.5;
            } else {
                playSound('hit');
                lives--;
            }
            
            updateHUD();
            modal.classList.add('hidden');
            
            if (lives <= 0) {
                gameOver();
            } else {
                gameState = 'PLAYING';
                animate();
            }
        }

        // --- UTILITAS ---
        function updateHUD() {
            document.getElementById('score-display').innerText = Math.floor(score);
            document.getElementById('lives-display').innerText = lives;
        }

        function drawBackground() {
            // Langit gradasi sudah ada di CSS
            // Awan bergerak
            ctx.fillStyle = "rgba(255, 255, 255, 0.4)";
            const cloudX = (frameCount * 0.5) % (canvas.width + 200);
            
            ctx.beginPath();
            ctx.arc(canvas.width - cloudX, 100, 30, 0, Math.PI * 2);
            ctx.arc(canvas.width - cloudX + 40, 100, 40, 0, Math.PI * 2);
            ctx.arc(canvas.width - cloudX + 80, 100, 30, 0, Math.PI * 2);
            ctx.fill();
        }

        function gameOver() {
            gameState = 'GAMEOVER';
            cancelAnimationFrame(animationId);
            document.getElementById('game-over-modal').classList.remove('hidden');
            document.getElementById('final-score').innerText = Math.floor(score);
        }

        function restartGame() {
            document.getElementById('game-over-modal').classList.add('hidden');
            startGame();
        }

        resizeCanvas();
    </script>
</body>
</html>